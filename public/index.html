<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />

	<link rel="stylesheet" href="css/jquery.mobile-1.4.4.min.css" />
    <link rel="stylesheet" href="css/ssOrange.min.css" />
    <link rel="stylesheet" href="css/alertify.core.css" />
    <link rel="stylesheet" href="css/alertify.default.css" />

	<script src="js/jquery-1.11.1.min.js"></script>
	<script src="js/jquery.mobile-1.4.4.min.js"></script>
    <script type="text/javascript" src="js/gauge.min.js"></script>
    <script type="text/javascript" src="js/2.0.0-crypto-sha1.js"></script>
    <script type="text/javascript" src="js/2.0.0-hmac-min.js"></script>
    <script type="text/javascript" src="js/sha1.js"></script>
    <script type="text/javascript" src="js/hotp.js"></script>
    <script type="text/javascript" src="js/chart.min.js"></script>
    <script type="text/javascript" src="js/alertify.min.js"></script>


	<title>Open Automation Center</title>

</head>

<body>

    <!-- homePage START -->
    <div data-role="page" id="home" data-theme="b" data-content-theme="b">
        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1>Open Automation Center</h1>
        </div>
        <div id="roomsList" data-role="content">
            <ul data-role="listview" id="rooms-list" data-inset="true">
            </ul>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#toolsList" class="ui-btn ui-icon-grid ui-btn-icon-top">ToolBox</a>
                </ul>
            </div>
        </div>
    </div>
    <!-- homePage END -->


    <!-- roomPage0 START -->
    <div data-role="page" id="roomPage0" data-theme="b" data-content-theme="b">
        <div id="roomHeader0" data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1> </h1>
        </div>
        <div data-role="content">
            <canvas id="gauge0"></canvas>
        </div>
        <div data-role="footer" data-tap-toggle="false" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#home" class="ui-btn ui-icon-bullets ui-btn-icon-top">Home</a>
                    <li><a href="#roomPage1" id="control0" class="ui-btn ui-icon-carat-r ui-btn-icon-top">Next</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- roomPage0 END -->


    <!-- roomPage1 START -->
    <div data-role="page" id="roomPage1" data-theme="b" data-content-theme="b">
        <div id="roomHeader1" data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1> </h1>
        </div>
        <div data-role="content">
            <canvas id="gauge1"></canvas>
        </div>
        <div data-role="footer" data-tap-toggle="false" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#roomPage0" id="control-1" class="ui-btn ui-icon-carat-l ui-btn-icon-top">Prev</a></li>
                    <li><a href="#roomPage2" id="control1" class="ui-btn ui-icon-carat-r ui-btn-icon-top">Next</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- roomPage1 END -->


    <!-- roomPage2 START -->
    <div data-role="page" id="roomPage2" data-theme="b" data-content-theme="b">
        <div id="roomHeader2" data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1> </h1>
        </div>
        <div data-role="content">
            <canvas id="gauge2"></canvas>
        </div>
        <div data-role="footer" data-tap-toggle="false" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#roomPage1" id="control-2" class="ui-btn ui-icon-carat-l ui-btn-icon-top">Prev</a></li>
                    <li><a href="#appsList" id="control2" class="ui-btn ui-icon-power ui-btn-icon-top">Control</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- roomPage2 END -->


    <!-- chartPage START -->
    <div data-role="page" id="chartPage" data-theme="b" data-content-theme="b">
        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1>Sensor history</h1>
        </div>
        <div data-role="content">

            <canvas id="chartZone" width="240" height="250"></canvas>

        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a id="chartCloseButton" href="#home" data-icon="back" data-role="button" data-rel="back" data-theme="b">Close</a>
                </ul>
            </div>
        </div>
    </div>
    <!-- chartPage END -->


    <!-- connectionSet-UpPage START -->
    <div data-role="page" id="connectionSet-UpPage" data-theme="b" data-content-theme="b">
        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1>Connection Set-Up</h1>
        </div>
        <div data-role="content">
            <div data-role="fieldcontainer">
                <label >Please enter OA Server ID:</label>
                <div class="ui-grid-a">
                    <div class="ui-block-a">
                        <input type="text" id="oaKeyInput" >
                    </div>
                    <div class="ui-block-c">
                        <a id="clearOAKey" href="#" data-role="button" data-inline="true" data-theme="b" >Clear</a>
                    </div>
                </div>
            </div>

            <p>
            </p>

            <div data-role="fieldcontainer">
                <label >Please enter OA Server IP address:</label>

                <div class="ui-grid-a">

                    <div class="ui-block-a">
                        <input type="text" id="oaIPAddressInput" >
                    </div>

                    <div class="ui-block-c">
                        <a id="clearOAIP" href="#" data-role="button" data-inline="true" data-theme="b" >Clear</a>
                    </div>
                </div>
            </div>
            <p>For more information please visit
                <a class="ui-link" onclick='window.open("http://openautomation.center","_system", "location=yes")' href='javascript:void(0)' >http://openautomation.center</a>
            </p>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a id="connectionSetupClose" href="#" data-icon="back" data-role="button" data-theme="b">Close</a>
                </ul>
            </div>
        </div>

    </div>
    <!-- connectionSet-UpPage END -->


    <!-- toolsListPage START -->
    <div data-role="page" id="toolsList" data-theme="b" data-content-theme="b">
        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1>ToolBox</h1>
        </div>
        <div data-role="content">
            <ul data-role="listview" data-inset="true">

                <li><a href="#connectionSet-UpPage">
                    <img src="icons/PNG/64x64/distribute-horizontal-centers.png" />
                    Connection Set-Up
                    <p>Enter Server ID and IP address</p></a>
                </li>

                <li><a href="#appsList">
                    <img src="icons/PNG/64x64/grid-2.png" />
                    Apps
                    <p>Installed Apps list</p></a>
                </li>

                <li><a href="#mainSensors">
                    <img src="icons/PNG/64x64/microphone.png" />
                    All sensors check
                    <p>Check all Sensors at once</p></a>
                </li>

            </ul>
        </div>
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-icon="back" data-role="button" data-rel="back" data-theme="b">Close</a>
                </ul>
            </div>
        </div>
    </div>
    <!-- toolsListPage END -->




    <!-- appsPage START -->
    <div data-role="page" id="appsList" data-theme="b" data-content-theme="b">
		<div data-role="header" data-position="fixed" data-tap-toggle="false">
		    <h1>Control apps</h1>
		</div>

        <div data-role="content">
            <ul data-role="listview" data-inset="true">

                <li><a href="#Green-House">
                    <img src="img/smartListGH.png" />
                    Green House
                    <p>Control green house: temperature, humidity and light</p></a>
                </li>

                <li><a href="#CO2">
                    <img src="img/smartListCo22.png" />
                    CO2 Free
                    <p>Enable functions to control CO2 level in room</p></a>
                </li>

                <li><a href="#Comfort-Zone">
                    <img src="img/smartListCZ.png" />
                    Comfort Zone
                    <p>Enable functions to control temperature</p></a>
                </li>

                <li><a href="#Switch-Box">
                    <img src="img/smartList.png" />
                    Switch Box
                    <p>9 switches with timers control board</p></a>
                </li>

            </ul>
        </div>

        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-icon="back" data-role="button" data-rel="back" data-theme="b">Close</a>
                </ul>
            </div>
        </div>

	</div>
    <!-- appsPage END -->


    <!-- mainSensors START -->
	<div data-role="page" id="mainSensors" data-theme="b" data-content-theme="b">
		<div data-role="header" data-position="fixed" data-tap-toggle="false">

		<h1 id="sensorsView"> Sensors View </h1>

		</div>
		<div data-role="content">

            <ul id="sensorsTable" data-role="listview" data-inset="true">

            </ul>

		</div>

		<div data-role="footer" data-position="fixed">
			<div data-role="navbar">
				<ul>
					<li><a href="#" data-icon="back" data-role="button" data-rel="back" data-theme="b">Close</a>
				</ul>
			</div>
		</div>
	</div>
    <!-- mainSensors END -->




<!-- Apps section  -->


    <!-- Switch-Box START -->
    <div data-role="page" id="Switch-Box" data-cache="false" data-title="Switch Box Control" data-theme="b" data-content-theme="b">

        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1 id="appSwitchBoxHeader">Switch Box</h1>
        </div>

        <div data-role="content">

            <div class="ui-grid-b">
                <div class="ui-block-a">
                    <label >SW1</label>
                    <input type="checkbox" id="SW01SB" data-role="flipswitch">
                </div>

                <div class="ui-block-b">
                    <label >SW2</label>
                    <input type="checkbox" id="SW02SB" data-role="flipswitch">
                </div>

                <div class="ui-block-c">
                    <label >SW3</label>
                    <input type="checkbox" id="SW03SB" data-role="flipswitch">
                </div>
            </div>

            <br>

            <div class="ui-grid-b">
                <div class="ui-block-a">
                    <label >SW4</label>
                    <input type="checkbox" id="SW04SB" data-role="flipswitch">
                </div>

                <div class="ui-block-b">
                    <label >SW5</label>
                    <input type="checkbox" id="SW05SB" data-role="flipswitch">
                </div>

                <div class="ui-block-c">
                    <label >SW6</label>
                    <input type="checkbox" id="SW06SB" data-role="flipswitch">
                </div>
            </div>

            <div data-role="collapsible-set">
                <div data-role="collapsible" data-collapsed="true" data-theme="b">
                    <h4>Timers </h4>
                    <div class="ui-grid-b">
                        <div class="ui-block-a">
                            <label > SW1 timer</label>
                            <input type="checkbox" id="TSW01SB" data-role="flipswitch">
                        </div>
                        <div class="ui-block-b">
                            <label >Time ON:</label>
                            <input type="time" id="T01ONSB"  placeholder="00:00">
                        </div>
                        <div class="ui-block-c">
                            <label >Time OFF:</label>
                            <input type="time" id="T01OFFSB"  placeholder="00:00">
                        </div>
                    </div>
                    <div class="ui-grid-b">
                        <div class="ui-block-a">
                            <label >SW2 timer</label>
                            <input type="checkbox" id="TSW02SB" data-role="flipswitch">
                        </div>
                        <div class="ui-block-b">
                            <label >Time ON:</label>
                            <input type="time" id="T02ONSB"  placeholder="00:00">
                        </div>
                        <div class="ui-block-c">
                            <label >Time OFF:</label>
                            <input type="time" id="T02OFFSB"  placeholder="00:00">
                        </div>
                    </div>
                    <div class="ui-grid-b">
                        <div class="ui-block-a">
                            <label >SW3 timer</label>
                            <input type="checkbox" id="TSW03SB" data-role="flipswitch">
                        </div>
                        <div class="ui-block-b">
                            <label >Time ON:</label>
                            <input type="time" id="T03ONSB"  placeholder="00:00">
                        </div>
                        <div class="ui-block-c">
                            <label >Time OFF:</label>
                            <input type="time" id="T03OFFSB"  placeholder="00:00">
                        </div>
                    </div>
                    <div class="ui-grid-b">
                        <div class="ui-block-a">
                            <label >SW4 timer</label>
                            <input type="checkbox" id="TSW04SB" data-role="flipswitch">
                        </div>
                        <div class="ui-block-b">
                            <label >Time ON:</label>
                            <input type="time" id="T04ONSB"  placeholder="00:00">
                        </div>
                        <div class="ui-block-c">
                            <label >Time OFF:</label>
                            <input type="time" id="T04OFFSB"  placeholder="00:00">
                        </div>
                    </div>
                    <div class="ui-grid-b">
                        <div class="ui-block-a">
                            <label >SW5 timer</label>
                            <input type="checkbox" id="TSW05SB" data-role="flipswitch">
                        </div>
                        <div class="ui-block-b">
                            <label >Time ON:</label>
                            <input type="time" id="T05ONSB"  placeholder="00:00">
                        </div>
                        <div class="ui-block-c">
                            <label >Time OFF:</label>
                            <input type="time" id="T05OFFSB"  placeholder="00:00">
                        </div>
                    </div>
                    <div class="ui-grid-b">
                        <div class="ui-block-a">
                            <label >SW6 timer</label>
                            <input type="checkbox" id="TSW06SB" data-role="flipswitch">
                        </div>
                        <div class="ui-block-b">
                            <label >Time ON:</label>
                            <input type="time" id="T06ONSB"  placeholder="00:00">
                        </div>
                        <div class="ui-block-c">
                            <label >Time OFF:</label>
                            <input type="time" id="T06OFFSB"  placeholder="00:00">
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#home" class="ui-btn ui-icon-bullets ui-btn-icon-top">Home</a>
                    <li><a href="#appsList" class="ui-btn ui-icon-grid ui-btn-icon-top">App list</a>
                </ul>
            </div>
        </div>
    </div>
    <!-- Switch-Box END -->


    <!-- CO2 START -->
    <div data-role="page" id="CO2" data-cache="false" data-title="CO2 Control" data-theme="b" data-content-theme="b">

        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1 id="appCO2FreeHeader">CO2 Free</h1>
        </div>

        <div data-role="content">
            <div data-role="fieldcontainer">
                <label id="temperatureSetLabelCO2" >Temperature set</label>
                <input type="range" id="temperatureSetCO2" data-highlight="true" min="10" max="50" value="25">
            </div>
            <div data-role="fieldcontainer">
                <label id="co2LevelSetLabelCO2" >CO2 level set</label>
                <input type="range" id="co2LevelSetCO2" data-highlight="true" min="380" max="900" value="500">
            </div>

            <br />
            <div class="ui-grid-b">
                <div class="ui-block-a">
                    <label >Mode</label>
                    <input type="checkbox" id="modeSetSwCO2" data-on-text="Heat" data-off-text="Cool" data-role="flipswitch">
                </div>

                <div class="ui-block-b">
                    <label >Fan</label>
                    <input type="checkbox" id="fanSwCO2" data-role="flipswitch">
                </div>

                <div class="ui-block-c">
                    <label >Fan timer</label>
                    <input type="checkbox" id="fanTimerSwCO2" data-role="flipswitch">
                </div>
            </div>

            <div data-role="collapsible-set">
                <div data-role="collapsible" data-collapsed="true" data-theme="b">
                    <h4>Fan On timer set</h4>
                    <div class="ui-grid-a">
                        <div class="ui-block-a">
                            <label >Fan from:</label>
                            <input type="time" id="fanFromCO2"  placeholder="00:00">
                        </div>
                        <div class="ui-block-b">
                            <label >Fan to:</label>
                            <input type="time" id="fanToCO2"  placeholder="00:00">
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#home" class="ui-btn ui-icon-bullets ui-btn-icon-top">Home</a>
                    <li><a href="#appsList" class="ui-btn ui-icon-grid ui-btn-icon-top">App list</a>
                </ul>
            </div>
        </div>
    </div>
    <!-- CO2 END -->


    <!-- Comfort-Zone START -->
    <div data-role="page" id="Comfort-Zone" data-cache="false" data-title="Temperature Control" data-theme="b" data-content-theme="b">

        <div data-role="header" data-position="fixed" data-tap-toggle="false">
            <h1 id="appComfortZoneHeader">Comfort Zone</h1>
        </div>

        <div data-role="content">

            <div data-role="fieldcontainer">
                <label id="temperatureLabelCZ" >Temperature set</label>
                <input type="range" id="temperatureSetCZ" data-highlight="true" min="10" max="50" value="25">
            </div>

            <div data-role="fieldcontainer">
                <label id="fanSpeedLabelCZ" >Fan speed set</label>
                <input type="range" id="fanSpeedSetCZ" data-highlight="true" min="0" max="4" value="0">
            </div>
            <br />
            <div class="ui-grid-b">
                <div class="ui-block-a">
                    <label >Power</label>
                    <input type="checkbox" id="powerOnSwCZ" data-role="flipswitch">
                </div>

                <div class="ui-block-b">
                    <label >Mode</label>
                    <input type="checkbox" id="modeSetCZ" data-on-text="Heat" data-off-text="Cool" data-role="flipswitch">
                </div>

                <div class="ui-block-c">
                    <label >Off-hours</label>
                    <input type="checkbox" id="offlineHoursModeSetCZ" data-role="flipswitch">
                </div>

            </div>



            <div data-role="collapsible-set">

                <div data-role="collapsible" data-collapsed="true" data-theme="b">
                    <h4>Offline hours time set</h4>

                    <div class="ui-grid-a">
                        <div class="ui-block-a">

                            <div data-role="fieldcontainer">

                                <label for="offHBCZ" >Off-hours start</label>
                                <input type="time" id="offHBCZ"  placeholder="00:00">

                            </div>

                        </div>

                        <div class="ui-block-b">

                            <label for="offHECZ" >Off-hours end</label>
                            <input type="time" id="offHECZ"  placeholder="00:00">

                        </div>

                    </div>


                </div>
            </div>

        </div>

        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#home" class="ui-btn ui-icon-bullets ui-btn-icon-top">Home</a>
                    <li><a href="#appsList" class="ui-btn ui-icon-grid ui-btn-icon-top">App list</a>
                </ul>
            </div>
        </div>
    </div>
    <!-- Comfort-Zone END -->


    <!-- Green-House START -->
    <div data-role="page" id="Green-House" data-cache="false" data-title="Green House Control" data-theme="b" data-content-theme="b">

		<div data-role="header" data-position="fixed" data-tap-toggle="false">
			<h1 id="appGreenHouseHeader">Green House Control</h1>

		</div>

		<div data-role="content">

			<div data-role="fieldcontainer">
				<label id="tSetLabel" for="temperatureSet">Temperature set</label>
				<input type="range" id="temperatureSet" name="temperatureSet" data-highlight="true" min="10" max="50" value="25">
			</div>

			<div data-role="fieldcontainer">
				<label id="hSetLabel" for="humiditySet">Humidity set</label>
				<input type="range" id="humiditySet" name="humiditySet" data-highlight="true" min="50" max="99" value="80">
			</div>

			<div data-role="fieldcontainer">
				<label id="wSetLabel" for="wateringDurationSet">Watering duration set</label>
				<input type="range" id="wateringDurationSet" name="wateringDurationSet" data-highlight="true" min="1" max="9" value="3">
			</div>

			<br />

			<div class="ui-grid-a">

				<div class="ui-block-a">
					<label for="lightOnSw">Light</label>
					<input type="checkbox" id="lightOnSw" data-role="flipswitch">
				</div>

				<div class="ui-block-b">
					<label for="fanOnSw">Fan</label>
					<input type="checkbox" id="fanOnSw" data-role="flipswitch">
				</div>
			</div>
			<div data-role="collapsible-set">
				<div data-role="collapsible" data-collapsed="true" data-theme="b">
					<h4>Humidity timers </h4>
                    <div class="ui-grid-a">
                        <div class="ui-block-a">

                            <div data-role="fieldcontainer">
                                <label for="wateringTimerSW">Turn ON timers</label>
                                <input type="checkbox" id="wateringTimerSW" data-role="flipswitch">
                            </div>

                        </div>

                        <div class="ui-block-b">
                            <a id="wTbutton1" href="#wateringTimerSet1" data-role="button" data-inline="true"  data-transition="pop">T1 00:00</a>
                            <a id="wTbutton2" href="#wateringTimerSet2" data-role="button" data-inline="true"  data-transition="pop">T2 00:00</a>
                            <a id="wTbutton3" href="#wateringTimerSet3" data-role="button" data-inline="true"  data-transition="pop">T3 00:00</a>
                            <a id="wTbutton4" href="#wateringTimerSet4" data-role="button" data-inline="true"  data-transition="pop">T4 00:00</a>
                            <a id="wTbutton5" href="#wateringTimerSet5" data-role="button" data-inline="true"  data-transition="pop">T5 00:00</a>
                        </div>

                    </div>
				</div>
				<div data-role="collapsible" data-collapsed="true" data-theme="b">
					<h4>Light timer</h4>

                    <div class="ui-grid-a">
                        <div class="ui-block-a">
                            <label for="lightTimerSW">Turn ON timer</label>
                            <div data-role="fieldcontainer">
                                <input type="checkbox" id="lightTimerSW" data-role="flipswitch">
                            </div>
                        </div>

                        <div class="ui-block-b">

                            <label for="lightOnTime" >Light On time</label>
                            <input type="time" id="lightOnTime" name="lightOnTime" placeholder="00:00">

                            <label for="lightOfftime" >Light Off time</label>
                            <input type="time" id="lightOffTime" name="lightOffTime" placeholder="00:00">

                        </div>

                    </div>
				</div>
			</div>

		</div>

		<div data-role="footer" data-position="fixed">
			<div data-role="navbar">
				<ul>
                    <li><a href="#home" class="ui-btn ui-icon-bullets ui-btn-icon-top">Home</a>
                    <li><a href="#appsList" class="ui-btn ui-icon-grid ui-btn-icon-top">App list</a>
				</ul>
			</div>
		</div>
	</div>
    <div data-role="page" id="wateringTimerSet1" data-dialog="true" data-overlay-theme="b" data-theme="b">
		<div data-role="header">
			<h1>Watering Timer 1</h1>
		</div>
		<div data-role="content">
			<div data-role="fieldcontainer" >
				<label for="wateringTimeSet1" >Enter watering time</label>
				<input type="time" id="wateringTimeSet1" name="wateringTimeSet1" placeholder="00:00">			
			</div>
		</div>
		<div data-role="footer" class="ui-bar">
			<a href="#" data-rel="back" >Close</a>
		</div>
	</div>
	<div data-role="page" id="wateringTimerSet2" data-dialog="true" data-overlay-theme="b" data-theme="b">
		<div data-role="header">
			<h1>Watering Timer 2</h1>
		</div>
		<div data-role="content">
			<div data-role="fieldcontainer" >
				<label for="wateringTimeSet2" >Enter watering time</label>
				<input type="time" id="wateringTimeSet2" name="wateringTimeSet2" placeholder="00:00">			
			</div>
		</div>
		<div data-role="footer" class="ui-bar">
			<a href="#" data-rel="back" >Close</a>
		</div>
	</div>
	<div data-role="page" id="wateringTimerSet3" data-dialog="true" data-overlay-theme="b" data-theme="b">
		<div data-role="header">
			<h1>Watering Timer 3</h1>
		</div>
		<div data-role="content">
			<div data-role="fieldcontainer" >
				<label for="wateringTimeSet3" >Enter watering time</label>
				<input type="time" id="wateringTimeSet3" name="wateringTimeSet3" placeholder="00:00">			
			</div>
		</div>
		<div data-role="footer" class="ui-bar">
			<a href="#" data-rel="back" >Close</a>
		</div>
	</div>
	<div data-role="page" id="wateringTimerSet4" data-dialog="true" data-overlay-theme="b" data-theme="b">
		<div data-role="header">
			<h1>Watering Timer 4</h1>
		</div>
		<div data-role="content">
			<div data-role="fieldcontainer" >
				<label for="wateringTimeSet4" data-overlay-theme="b" data-theme="b" >Enter watering time</label>
				<input type="time" id="wateringTimeSet4" name="wateringTimeSet4" placeholder="00:00">			
			</div>
		</div>
		<div data-role="footer" class="ui-bar">
			<a href="#" data-rel="back" >Close</a>
		</div>
	</div>
	<div data-role="page" id="wateringTimerSet5" data-dialog="true" data-overlay-theme="b" data-theme="b">
		<div data-role="header">
			<h1>Watering Timer 5</h1>
		</div>
		<div data-role="content">
			<div data-role="fieldcontainer" >
				<label for="wateringTimeSet5" >Enter watering time</label>
				<input type="time" id="wateringTimeSet5" name="wateringTimeSet5" placeholder="00:00">			
			</div>
		</div>
		<div data-role="footer" class="ui-bar">
			<a href="#" data-rel="back"  data-theme="b">Close</a>
		</div>
	</div>
    <!-- Green-House END -->



<script type="text/javascript">


// Main parameters
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
jQuery.support.cors = true;

var UTCTimeShift = 2;
var acceptableSensorTimeShiftMinutes = 2;
var debugMode = false;
var tokenLink = 'token';
var infoLink = 'info';



// Functions
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Application commands handler
function appCommandPost(tokenLink, postData) {

    console.log('appCommandPost > ' + tokenLink+ ' Loading...');

    $.getJSON(tokenLink, function(oaToken) {
        if (oaToken) {
            var sessionID = getToken(oaToken);
            var pLink = 'control/' + sessionID;
            $.ajax({
                type: "POST",
                async: true,
                url: pLink,
                data: postData,
                success: function (response) {
                    var answer = JSON.parse(response);
                    if (answer.status == 'welcome') {

                    } else {
                        //toast.showShort(" Authentication Error! \n Please set correct Server ID in Connection Settings tab.");
                        //alertify.log('Authentication Error! Check Server ID', '', 4000);
                    }
                }
            });
        }
    });
}


// Connection Set-Up
function handleConnectionSetup() {

        $(document).on('pagebeforeshow', '#connectionSet-UpPage', function () {
            if (window.localStorage.getItem('oa.serverID')) $('input#oaKeyInput').val(window.localStorage.getItem('oa.serverID'));
            if (window.localStorage.getItem('oa.serverIP')) $('input#oaIPAddressInput').val(window.localStorage.getItem('oa.serverIP'));
        });

        $("#oaKeyInput").bind("change", function (event, ui) {
            window.localStorage.setItem('oa.serverID', $('#oaKeyInput').val());
        });

        $("#oaIPAddressInput").bind("change", function (event, ui) {
            window.localStorage.setItem('oa.serverIP', $('#oaIPAddressInput').val());
        });

        $(document).on("tap", '#clearOAKey', function () {
            $("input#oaKeyInput").val('');
        });

        $(document).on("tap", '#clearOAIP', function () {
            $('input#oaIPAddressInput').val('');
        });

        $( document ).on( "tap", '#connectionSetupClose', function( event ) {
            event.preventDefault();
            getOA(tokenLink, infoLink, getRoomList);

            $.mobile.navigate('#home');
        });



}


// Check Sensors routine
function handleSensors() {

    $(document).on('pagebeforecreate', '#mainSensors', function(){
        var interval = setInterval(function(){
            $.mobile.loading('show');
            clearInterval(interval);
        },100);
    });

    $(document).on('pageshow', '#mainSensors', function(){
        var interval = setInterval(function(){
            $.mobile.loading('hide');
            clearInterval(interval);
        },100);
    });

    $(document).on('pagebeforeshow', '#mainSensors', function(e, data){

        var activeApp = data.prevPage.attr('id');
        var sensorsLabel = 'All Sensors';

        $('h1#sensorsView').html(sensorsLabel);

        getOA(tokenLink, infoLink, function(){

            var sensorCount = oa.oa.sensors.length;
            var tableConstruction = '';
            var sensorValue = '0';
            var sensorID = '';
            var sensorLabel = '';
            var sensorUnits = '';
            var sensorTime = '';

            if (sensorCount > 0){
                for( var i = 0, lenSensorCount = sensorCount; i < lenSensorCount; i++ ) {

                    sensorID = oa.oa.sensors[i];

                    if (!!oa.allSensors[sensorID]) {
                        sensorValue = oa.allSensors[sensorID];
                    } else {
                        sensorValue = '0';
                    }
                    if (!!oa.allSensorsDates[sensorID]) {
                        sensorTime = oa.allSensorsDates[sensorID];
                    } else {
                        sensorTime = '';
                    }
                    if (!!oa.oa.sensorsLabel[i]) {
                        sensorLabel = oa.oa.sensorsLabel[i];
                    } else {
                        sensorLabel = '';
                    }
                    if (!!oa.oa.sensorsUnit[i]) {
                        sensorUnits = oa.oa.sensorsUnit[i];
                    } else {
                        sensorUnits = '';
                    }

                    var sensorMinimumValue;
                    var sensorMaximumValue;
                    var status = 0;
                    //if (parseFloat(sensorValue) < parseFloat(sensorMinimumValue)) status = 2;
                    //if (parseFloat(sensorValue) > parseFloat(sensorMaximumValue)) status = 1;
                    tableConstruction += oneSensorRow(sensorID, sensorLabel, sensorValue, sensorUnits, sensorTime, status);
                }
            }

            console.log('handleSensors > processing ' + sensorCount + ' sensors');
            $("#sensorsTable").html(tableConstruction).listview("refresh");
        });


        function oneSensorRow(sensorID, sensorLabel, sensorValue, sensorUnits, sensorTime, status) {

            var statusOK = ' ';
            var statusOver = ' Over! ';
            var statusUnder = ' Under! ';
            var statusValue = ' ';
            var sensorHighlightColor = '';
            var sensorType = sensorID.substring(0,1);

            if (sensorType == 'T') sensorHighlightColor = '<img src="img/star_red.png" class="ui-li-icon">';
            if (sensorType == 'H') sensorHighlightColor = '<img src="img/star_blue.png" class="ui-li-icon">';
            if (sensorType == 'C') sensorHighlightColor = '<img src="img/star_yellow.png" class="ui-li-icon">';
            if (sensorType == 'E') sensorHighlightColor = '<img src="img/star_black.png" class="ui-li-icon">';
            if (sensorType == 'P') sensorHighlightColor = '<img src="img/star_black.png" class="ui-li-icon">';

            if (status == 0) statusValue = statusOK;
            if (status == 1) statusValue = statusOver;
            if (status == 2) statusValue = statusUnder;


            var diff = Math.abs(new Date() - new Date(sensorTime));
            var minutes = Math.floor((diff/1000)/60);
            var minutesToDisplay = ' ';

            if (!!minutes && minutes > acceptableSensorTimeShiftMinutes ) {
                minutesToDisplay = ' ' + (minutes - acceptableSensorTimeShiftMinutes) + ' min. ago' + ' ';
            }

            if(isNaN(minutes)) {
                statusValue = ' waiting...';
            } else {
                statusValue = '';
            }

            return '<li>'
                    + sensorHighlightColor
                    + sensorID  + ' - '  + sensorLabel
                    + '<span class="ui-li-count">' + sensorValue  + sensorUnits + statusValue  + minutesToDisplay + '</span>'
                    + '</li>';
        }
    });
}


// Show Sensors on gouge
function showSensors(sensorType, sensorID){

    console.log('showSensors > sensorID: ' + sensorID + ' sensorType: ' + sensorType);

    for (var i = 0; i < sensorType.length; i++) {
            var activeSensor = sensorType[i];
            var activeSensorID = sensorID[i];
            var type = activeSensor.substring(0, 1);
            var renderTo = 'gauge' + i;

            //First sensor
            if (type == 'T' && sensorType.length > 1) setTimeout(showSensorT.bind(null, renderTo, activeSensor), 10);
            if (type == 'T' && sensorType.length == 1) showSensorT(renderTo, activeSensor);

            //Second sensor
            if (type == 'H' && sensorType.length > 1) setTimeout(showSensorH.bind(null, renderTo, activeSensor), 550);
            if (type == 'H' && sensorType.length == 1) showSensorH(renderTo, activeSensor);

            //Third sensor
            if (type == 'C' && sensorType.length > 1) setTimeout(showSensorC.bind(null, renderTo, activeSensor), 1050);
            if (type == 'C' && sensorType.length == 1) showSensorC(renderTo, activeSensor);

            //Second sensor
            if (type == 'P' && sensorType.length > 1) setTimeout(showSensorP.bind(null, renderTo, activeSensor), 550);
            if (type == 'P' && sensorType.length == 1) showSensorP(renderTo, activeSensor);

            //Third sensor
            if (type == 'E' && sensorType.length > 1) setTimeout(showSensorE.bind(null, renderTo, activeSensor), 1050);
            if (type == 'E' && sensorType.length == 1) showSensorE(renderTo, activeSensor);
    }


    function showSensorT(renderTo, activeSensor) {

            window.localStorage.setItem(renderTo, activeSensor);

            var gauge = new Gauge({

                renderTo: renderTo,
                title: 'Temperature',
                width: document.body.offsetWidth/1.1,
                height: document.body.offsetHeight/1.5,
                glow: true,
                units: '°C',
                minValue: -30,
                maxValue: 30,
                colors      : {
                    plate      : '#222',
                    //majorTicks : '#f5f5f5',
                    //minorTicks : '#ddd',
                    title      : '#fff',
                    units      : '#ccc',
                    numbers    : '#eee',
                    needle     : { start:'rgba(240, 128, 128, 1)', end :'rgba(255, 160, 122, .9)' }
                },
                    strokeTicks : true,
                    highlights : [
                {
                    from  : -30,
                    to    : 0,color : 'LightBlue'
                }, {
                    from  : 0,
                    to    : 20,color : 'PaleGreen'
                }, {
                    from  : 20,
                    to    : 25,color : 'Khaki'
                }, {
                    from  : 25,
                    to    : 30,color : 'LightSalmon'
                }],
                    animation : {
                    delay : 25,
                    duration: 600,
                    fn : 'elastic'
                }
        });

        drawCanvas(gauge, activeSensor);
    }

    function showSensorH(renderTo, activeSensor) {

        window.localStorage.setItem(renderTo, activeSensor);

        var gauge = new Gauge({

            renderTo: renderTo,
            title: 'Humidity',
            width: document.body.offsetWidth/1.1,
            height: document.body.offsetHeight/1.5,
            glow: true,
            units: '%',
            minValue: 0,
            maxValue: 100,
            majorTicks  : ['0','10','20','30','40','50','60','70','80','100'],
            minorTicks  : 2,
            strokeTicks : false,
            highlights  : [
            { from : 0, to : 50,  color : 'rgba(255, 30,  0, .25)' },
            { from : 50, to : 100,   color : 'rgba(0, 0,  255, .25)' }
            ],
            colors      : {
                plate      : '#222',
                majorTicks : '#f5f5f5',
                minorTicks : '#ddd',
                title      : '#fff',
                units      : '#ccc',
                numbers    : '#eee',
                needle     : { start:'rgba(240, 128, 128, 1)', end :'rgba(255, 160, 122, .9)' }
            },
            animation : {
                delay : 25,
                duration: 600,
                fn : 'elastic'
            }
        });

        drawCanvas(gauge, activeSensor);
    }

    function showSensorC(renderTo, activeSensor) {

        window.localStorage.setItem(renderTo, activeSensor);

        var gauge = new Gauge({

            renderTo: renderTo,
            title: 'CO2',
            width: document.body.offsetWidth/1.1,
            height: document.body.offsetHeight/1.5,
            glow: true,
            units: 'ppm',
            minValue: 350,
            maxValue: 3500,
            colors      : {
                plate      : '#222',
                //majorTicks : '#f5f5f5',
                //minorTicks : '#ddd',
                title      : '#fff',
                units      : '#ccc',
                numbers    : '#eee',
                needle     : { start:'rgba(240, 128, 128, 1)', end :'rgba(255, 160, 122, .9)' }
            },
            strokeTicks : false,
            highlights : [
                {
                    from  : 350,
                    to    : 500,color : 'LightBlue'
                }, {
                    from  : 500,
                    to    : 1500,color : 'PaleGreen'
                }, {
                    from  : 1500,
                    to    : 2000,color : 'Khaki'
                }, {
                    from  : 2000,
                    to    : 3500,color : 'LightSalmon'
                }],
            animation : {
                delay : 25,
                duration: 600,
                fn : 'elastic'
            }
        });

        drawCanvas(gauge, activeSensor);
    }

    function showSensorP(renderTo, activeSensor) {

        window.localStorage.setItem(renderTo, activeSensor);

        var gauge = new Gauge({

            renderTo: renderTo,
            title: 'Power',
            width: document.body.offsetWidth/1.1,
            height: document.body.offsetHeight/1.5,
            glow: true,
            units: 'W',
            minValue: 0,
            maxValue: 1000,
            colors      : {
                plate      : '#222',
                //majorTicks : '#f5f5f5',
                //minorTicks : '#ddd',
                title      : '#fff',
                units      : '#ccc',
                numbers    : '#eee',
                needle     : { start:'rgba(240, 128, 128, 1)', end :'rgba(255, 160, 122, .9)' }
            },
            strokeTicks : false,
            highlights : [
                {
                    from  : 0,
                    to    : 300,color : 'PaleGreen'
                }, {
                    from  : 300,
                    to    : 700,color : 'Khaki'
                }, {
                    from  : 700,
                    to    : 1000,color : 'LightSalmon'
                }],
            animation : {
                delay : 25,
                duration: 600,
                fn : 'elastic'
            }
        });

        drawCanvas(gauge, activeSensor);
    }

    function showSensorE(renderTo, activeSensor) {

        window.localStorage.setItem(renderTo, activeSensor);

        var gauge = new Gauge({

            renderTo: renderTo,
            title: 'Energy',
            width: document.body.offsetWidth/1.1,
            height: document.body.offsetHeight/1.5,
            glow: true,
            units: 'kWh',
            minValue: 0,
            maxValue: 1000,

            majorTicks  : ['0','100','200','300','400','500','600','700','800','1000'],
            minorTicks  : 2,
            strokeTicks : false,
        /*    highlights  : [
                { from : 0, to : 40,   color : 'rgba(0, 0,  255, .25)' },
                { from : 40, to : 80,  color : 'rgba(255, 30,  0, .25)' }
            ],
        */
            colors      : {
                plate      : '#222',
                majorTicks : '#f5f5f5',
                minorTicks : '#ddd',
                title      : '#fff',
                units      : '#ccc',
                numbers    : '#eee',
                needle     : { start:'rgba(240, 128, 128, 1)', end :'rgba(255, 160, 122, .9)' }
            },

            animation : {
                delay : 25,
                duration: 600,
                fn : 'elastic'
            }
        });

        drawCanvas(gauge, activeSensor);
    }

}


// Draw sensor gauge
function drawCanvas(gauge, sensorType){
    console.log('drawCanvas step1 > sensor:' + sensorType );

    gauge.onready = function() {

        getOA(tokenLink, infoLink, function(){

                var sensorValue = '0';
                var sensorTimeStr = '';

                if (!!oa.allSensors) sensorValue = oa.allSensors[sensorType];
                if (!!oa.allSensorsDates) sensorTimeStr = oa.allSensorsDates[sensorType];
                if (sensorValue == '') sensorValue = '0';

                var diff = Math.abs(new Date() - new Date(sensorTimeStr));
                var minutes = Math.floor((diff/1000)/60);

                if (!!minutes && minutes > acceptableSensorTimeShiftMinutes ) {
                    alertify.log("Sensor " + sensorType + " inactive " + (minutes - acceptableSensorTimeShiftMinutes) + " min!", "", 4000);
                }

                if(isNaN(minutes)) alertify.log("Sensor " + sensorType + " value not received yet!", "", 3000);

                gauge.setValue( sensorValue );
                console.log('drawCanvas step 2 > sensor:' + sensorType + ' value:' + sensorValue);
        });
    };

    gauge.draw();

    window.onresize= function() {
        gauge.updateConfig({
            width  : document.body.offsetWidth/1.1,
            height : document.body.offsetHeight/1.5
        });
    };
}


// Draw Line Chart after click on gauge
function handleCanvasClicks(){

    $( document ).on( "tap", '#chartCloseButton', function( event ) {
        event.preventDefault();
        try {
            lineChart.destroy();
            $.mobile.navigate('#roomPage0');
        } catch(e) {
            console.log('lineChart Object not found!')
            $.mobile.navigate('#roomPage0');
        }
    });

    var sensorChartSelect = '';

    function drawLineChart(sensorData){

        var lineChart;

        console.log('lineChart > sensor data received: ' + JSON.stringify(sensorData));

        sensorData.datasets[0].fillColor = "rgba(255,200,100,0.2)";
        sensorData.datasets[0].strokeColor = "rgba(255,200,100,1)";
        sensorData.datasets[0].pointColor = "rgba(255,200,100,1)";
        sensorData.datasets[0].pointStrokeColor = "#fff";
        sensorData.datasets[0].pointHighlightFill = "#fff";
        sensorData.datasets[0].pointHighlightStroke = "rgba(255,200,100,1)";

        var ctx = $('#chartZone').get(0).getContext('2d');

        window.lineChart = new Chart(ctx).Line(sensorData, {
            responsive: true,
            maintainAspectRatio: true
        });

    }


    $( document ).on( "tap", '#gauge0', function() {
        sensorChartSelect = window.localStorage.getItem('gauge0');
        $.mobile.navigate('#chartPage');
        //$.mobile.changePage( "#chartPage", { transition: "fade", changeHash: true });
        //$( "body" ).pagecontainer( "change", "#chartPage", { transition: "fade", changeHash: false });
    });


    $( "#gauge0" ).on( "swipe", function(){

        $.mobile.navigate('#'+ oa.oa.rooms[activeRoom.id].app);

    });


    $( document ).on( "tap", '#gauge1', function() {
        sensorChartSelect = window.localStorage.getItem('gauge1');
        $.mobile.navigate('#chartPage');

    });

    $( document ).on( "tap", '#gauge2', function() {
        sensorChartSelect = window.localStorage.getItem('gauge2');
        $.mobile.navigate('#chartPage');
    });


    $(document).on( "pagecontainershow", function( event, ui ) {

        if (ui.toPage.prop("id") == "chartPage"){

            $('#chartPage h1').text(activeRoom.label + ' ' + sensorChartSelect);

                console.log('lineChart > ' + tokenLink+ ' loading...');
                $.getJSON(tokenLink, function(token) {
                    if (token) {
                        var sessionID = getToken(token);
                        var hLink = 'sensor/' + sessionID + '/' + sensorChartSelect;
                        $.getJSON(hLink, function (sensorData) {
                            if (sensorData) {
                                drawLineChart(sensorData);
                            } else {
                                console.log('lineChart > ERROR: sensor data not received from ' + hLink);
                            }
                        });
                    } else {
                        console.log('lineChart > ERROR: Con\'t get token from ' + tokenLink);
                    }
                });

        }
    });

}


// Generate session ID from token
function getToken(received){

    function stringToHex (tmp) {
        function d2h(d) {
            return d.toString(16);
        }
        var str = '', i = 0, l = tmp.length, c;
        for (; i < l; i += 1) {
            c = tmp.charCodeAt(i);
            str += d2h(c);
        }
        return str;
    }

    secret = '123456789';
    var serverID = window.localStorage.getItem('oa.serverID');
    if (serverID) secret = stringToHex(serverID);
    var hotpID = hotp(secret, received, "dec6" );
    var sessionID = CryptoJS.SHA1(hotpID);
    //alert('hotpID:' + hotpID + ' Secret:' + secret + ' Token:' + received + ' sessionID:' + sessionID);
    console.log('getToken > Token:' + received + ' for session:' + hotpID + ':' + sessionID);

    return sessionID;
}


// Get config from OA server
function getOA(tokenLink, infoLink, cb){

        console.log('getOA > ' + tokenLink+ ' Loading...');

        $.getJSON(tokenLink, function(oaToken) {
            if (oaToken) {

                var sessionID = getToken(oaToken);
                var iLink = infoLink + '/' + sessionID;

                $.getJSON(iLink, function(oaConfig) {
                    if (!!oaConfig && !oaConfig.status) {
                        oa = oaConfig;
                        console.log('getOA > Config loaded successfully from ' + infoLink);
                        if (debugMode) console.log(JSON.stringify(oa));
                        cb();
                    } else {
                        //$.mobile.navigate('#connectionSet-UpPage');
                        alertify.log('Authentication Error! Check Server ID', '', 2000);
                        console.log('getOA > ERROR: Config not loaded from ' + infoLink);
                    }
                });

            } else {
                console.log('getOA > ERROR: Con\'t get token from ' + tokenLink);
            }
        });
}


// Step-01 Get Room list from OA config
function getRoomList(){

    function roomListConfig(){
        var liStr = '';
        for (var i = 0; i < oa.oa.rooms.length; i++) {

            liStr += '<li><a href="" data-id="' + i
            + '"> <img src="img/room.png" />' + oa.oa.rooms[i].label + '<p>Control ' + oa.oa.rooms[i].label + ' ' + oa.oa.rooms[i].app
            + '</p></a></li>'
        }
        return liStr;
    }

    $('#rooms-list li').remove();
    $('#rooms-list').append(roomListConfig).listview('refresh');

    $(document).on('tap', '#rooms-list li a', function(){
        activeRoom.id = $(this).attr('data-id');
        activeRoom.label = oa.oa.rooms[activeRoom.id].label;
        activeRoom.sensors = oa.oa.rooms[activeRoom.id].sensors;
        activeRoom.allSensors = oa.oa.sensors;

        //alert('getRoomList > Room selected: ' + activeRoom.label + ' activeRoom: ' + JSON.stringify(activeRoom));

        $( "body" ).pagecontainer( "change", "#roomPage0", { transition: "fade", changeHash: false });
    });
}


// Step-02 Handle sensors in active room
function handleRoom(){

    $(document).on('pagebeforeshow', '#roomPage0', function(e, data) {

        console.log('Active Room: ' + activeRoom.label);
        $('#roomHeader0 h1').text(activeRoom.label);

        var sensorID = [], sensorType = [];

        for (var i = 0; i < activeRoom.sensors.length; i++) {
            for (var k = 0; k < activeRoom.allSensors.length; k++) {
                if(activeRoom.sensors[i] == activeRoom.allSensors[k]) {
                    sensorID.push(k);
                    sensorType.push(activeRoom.allSensors[k]);
                }
            }
        }

        var controlB0 = $('#control0');
        var controlB1 = $('#control1');
        var controlB2 = $('#control2');

        if (activeRoom.sensors.length == 1) {

            controlB0.text('Control');
            controlB0.removeClass( 'ui-icon-carat-r');
            controlB0.addClass( ' ui-icon-power ');
            if(!oa.status) controlB0.prop("href", '#'+ oa.oa.rooms[activeRoom.id].app);
        }

        if (activeRoom.sensors.length == 2) {
            controlB1.text('Control');
            controlB1.removeClass( 'ui-icon-carat-r');
            controlB1.addClass( ' ui-icon-power ');
            if(!oa.status) controlB1.prop("href", '#'+ oa.oa.rooms[activeRoom.id].app);

            controlB0.text('Next');
            controlB0.removeClass( 'ui-icon-power');
            controlB0.addClass( 'ui-icon-carat-r');
            controlB0.prop("href", "#roomPage1");
        }

        if (activeRoom.sensors.length > 2) {
            controlB0.text('Next');
            controlB0.removeClass( 'ui-icon-power');
            controlB0.addClass( 'ui-icon-carat-r');
            controlB0.prop("href", "#roomPage1");

            controlB1.text('Next');
            controlB1.removeClass( 'ui-icon-power');
            controlB1.addClass( 'ui-icon-carat-r');
            controlB1.prop("href", "#roomPage2");

            if(!oa.status) controlB2.prop("href", '#'+ oa.oa.rooms[activeRoom.id].app);
        }

        console.log('handleRoom > sensorID: ' + sensorID + ' sensorType: ' + sensorType);

        showSensors(sensorType, sensorID);
    });

    $(document).on('pagebeforeshow', '#roomPage1', function(e, data) {
        $('#roomHeader1 h1').text(activeRoom.label);
        if (activeRoom.sensors.length < 2) $('#room1B').hide();
        if (activeRoom.sensors.length > 1) {
            $('#room1B').show();
            $('room1S0').text(activeRoom.sensors[0]);
            $('room1S1').text(activeRoom.sensors[1]);
        }
        if (activeRoom.sensors.length > 2) $('room1S2').text(activeRoom.sensors[2]);

    });
    $(document).on('pagebeforeshow', '#roomPage2', function(e, data) {
        $('#roomHeader2 h1').text(activeRoom.label);
        if (activeRoom.sensors.length < 2) $('#room2B').hide();
        if (activeRoom.sensors.length > 1) {
            $('#room2B').show();
            $('room2S0').text(activeRoom.sensors[0]);
            $('room2S1').text(activeRoom.sensors[1]);
        }
        if (activeRoom.sensors.length > 2) $('room2S2').text(activeRoom.sensors[2]);

    });

}


// Step-03 Applications Start-Up
function handleApps() {

    appSwitchBox();
    appComfortZone();
    appGreenHouse();
    appCO2Free();

}


// Program Entry Point
//$(document).ready(function(){
$(document).on('pagecreate', '#home', function() {

    // Global variables
    oa = {};
    activeRoom = {
        id : null,
        label : null,
        sensors : [],
        allSensors : []
    };

    // STEP-00 - Getting config from OA server
    getOA(tokenLink, infoLink, getRoomList);

    handleSensors();
    handleRoom();
    handleCanvasClicks();
    handleConnectionSetup();
    handleApps();

});





// Applications section
// Place installed apps here. Include app function in handleApps().
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// Switch-Box - 6 switches app v.1.0.1 (c) Vaidotas Gudaitis
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function appSwitchBox(){

    $(document).on('pagebeforeshow', '#Switch-Box', function(){

        $('h1#appSwitchBoxHeader').html(activeRoom.label);

        var sel = 'switchBox' + activeRoom.id;

        if (window.localStorage.getItem(sel+'.SW01SB') == 'true')     {
            $("input#SW01SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#SW01SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.SW02SB') == 'true')     {
            $("input#SW02SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#SW02SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.SW03SB') == 'true')     {
            $("input#SW03SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#SW03SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.SW04SB') == 'true')     {
            $("input#SW04SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#SW04SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.SW05SB') == 'true')     {
            $("input#SW05SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#SW05SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.SW06SB') == 'true')     {
            $("input#SW06SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#SW06SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.TSW01SB') == 'true')     {
            $("input#TSW01SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#TSW01SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.TSW02SB') == 'true')     {
            $("input#TSW02SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#TSW02SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.TSW03SB') == 'true')     {
            $("input#TSW03SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#TSW03SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.TSW04SB') == 'true')     {
            $("input#TSW04SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#TSW04SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.TSW05SB') == 'true')     {
            $("input#TSW05SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#TSW05SB").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.TSW06SB') == 'true')     {
            $("input#TSW06SB").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#TSW06SB").prop("checked", false).flipswitch("refresh");
        }

        if (window.localStorage.getItem(sel+'.T01ONSB')) $('input#T01ONSB').val(window.localStorage.getItem(sel+'.T01ONSB'));
        if (window.localStorage.getItem(sel+'.T01OFFSB')) $('input#T01OFFSB').val(window.localStorage.getItem(sel+'.T01OFFSB'));
        if (window.localStorage.getItem(sel+'.T02ONSB')) $('input#T02ONSB').val(window.localStorage.getItem(sel+'.T02ONSB'));
        if (window.localStorage.getItem(sel+'.T02OFFSB')) $('input#T02OFFSB').val(window.localStorage.getItem(sel+'.T02OFFSB'));
        if (window.localStorage.getItem(sel+'.T03ONSB')) $('input#T03ONSB').val(window.localStorage.getItem(sel+'.T03ONSB'));
        if (window.localStorage.getItem(sel+'.T03OFFSB')) $('input#T03OFFSB').val(window.localStorage.getItem(sel+'.T03OFFSB'));
        if (window.localStorage.getItem(sel+'.T04ONSB')) $('input#T04ONSB').val(window.localStorage.getItem(sel+'.T04ONSB'));
        if (window.localStorage.getItem(sel+'.T04OFFSB')) $('input#T04OFFSB').val(window.localStorage.getItem(sel+'.T04OFFSB'));
        if (window.localStorage.getItem(sel+'.T05ONSB')) $('input#T05ONSB').val(window.localStorage.getItem(sel+'.T05ONSB'));
        if (window.localStorage.getItem(sel+'.T05OFFSB')) $('input#T05OFFSB').val(window.localStorage.getItem(sel+'.T05OFFSB'));
        if (window.localStorage.getItem(sel+'.T06ONSB')) $('input#T06ONSB').val(window.localStorage.getItem(sel+'.T06ONSB'));
        if (window.localStorage.getItem(sel+'.T06OFFSB')) $('input#T06OFFSB').val(window.localStorage.getItem(sel+'.T06OFFSB'));

    });

    $(document).on('pagecreate', '#Switch-Box', function () {

        function buildCommandSwitchBox() {

            var t01ON = $("#T01ONSB").val() || '00:00', t01OFF = $("#T01OFFSB").val() || '00:00';
            var t02ON = $("#T02ONSB").val() || '00:00', t02OFF = $("#T02OFFSB").val() || '00:00';
            var t03ON = $("#T03ONSB").val() || '00:00', t03OFF = $("#T03OFFSB").val() || '00:00';
            var t04ON = $("#T04ONSB").val() || '00:00', t04OFF = $("#T04OFFSB").val() || '00:00';
            var t05ON = $("#T05ONSB").val() || '00:00', t05OFF = $("#T05OFFSB").val() || '00:00';
            var t06ON = $("#T06ONSB").val() || '00:00', t06OFF = $("#T06OFFSB").val() || '00:00';

            if (t01ON.length < 5) t01ON = '0' + t01ON;
            if (t01OFF.length < 5) t01OFF = '0' + t01OFF;
            if (t02ON.length < 5) t02ON = '0' + t02ON;
            if (t02OFF.length < 5) t02OFF = '0' + t02OFF;
            if (t03ON.length < 5) t03ON = '0' + t03ON;
            if (t03OFF.length < 5) t03OFF = '0' + t03OFF;
            if (t04ON.length < 5) t04ON = '0' + t04ON;
            if (t04OFF.length < 5) t04OFF = '0' + t04OFF;
            if (t05ON.length < 5) t05ON = '0' + t05ON;
            if (t05OFF.length < 5) t05OFF = '0' + t05OFF;
            if (t06ON.length < 5) t06ON = '0' + t06ON;
            if (t06OFF.length < 5) t06OFF = '0' + t06OFF;

            var command = 'F' + activeRoom.id + ':';

            if($("input#SW01SB").is(":checked")){command+='S1=1';}else{if($('input#TSW01SB').is(':checked')){command+='S1=T';}else{command+='S1=0';}}
            if($("input#SW02SB").is(":checked")){command+='S2=1';}else{if($('input#TSW02SB').is(':checked')){command+='S2=T';}else{command+='S2=0';}}
            if($("input#SW03SB").is(":checked")){command+='S3=1';}else{if($('input#TSW03SB').is(':checked')){command+='S3=T';}else{command+='S3=0';}}
            if($("input#SW04SB").is(":checked")){command+='S4=1';}else{if($('input#TSW04SB').is(':checked')){command+='S4=T';}else{command+='S4=0';}}
            if($("input#SW05SB").is(":checked")){command+='S5=1';}else{if($('input#TSW05SB').is(':checked')){command+='S5=T';}else{command+='S5=0';}}
            if($("input#SW06SB").is(":checked")){command+='S6=1';}else{if($('input#TSW06SB').is(':checked')){command+='S6=T';}else{command+='S6=0';}}
            
            command += 'T1=' + t01ON + t01OFF;
            command += 'T2=' + t02ON + t02OFF;
            command += 'T3=' + t03ON + t03OFF;
            command += 'T4=' + t04ON + t04OFF;
            command += 'T5=' + t05ON + t05OFF;
            command += 'T6=' + t06ON + t06OFF;
            
            var commandToPost = {decision: 'setCommand', roomID: activeRoom.id, command: command};

            appCommandPost(tokenLink, commandToPost);
        }

        $("input#SW01SB").change(function () {
            var sel = 'switchBox' + activeRoom.id + '.SW01SB';
            if($(this).is(":checked")){window.localStorage.setItem(sel,'true');buildCommandSwitchBox();}else{window.localStorage.setItem(sel,'false');buildCommandSwitchBox();}
        });
        $("input#SW02SB").change(function () {
            var sel = 'switchBox' + activeRoom.id + '.SW02SB';
            if($(this).is(":checked")){window.localStorage.setItem(sel,'true');buildCommandSwitchBox();}else{window.localStorage.setItem(sel,'false');buildCommandSwitchBox();}
        });
        $("input#SW03SB").change(function () {
            var sel = 'switchBox' + activeRoom.id + '.SW03SB';
            if($(this).is(":checked")){window.localStorage.setItem(sel,'true');buildCommandSwitchBox();}else{window.localStorage.setItem(sel,'false');buildCommandSwitchBox();}
        });
        $("input#SW04SB").change(function () {
            var sel = 'switchBox' + activeRoom.id + '.SW04SB';
            if($(this).is(":checked")){window.localStorage.setItem(sel,'true');buildCommandSwitchBox();}else{window.localStorage.setItem(sel,'false');buildCommandSwitchBox();}
        });
        $("input#SW05SB").change(function () {
            var sel = 'switchBox' + activeRoom.id + '.SW05SB';
            if($(this).is(":checked")){window.localStorage.setItem(sel,'true');buildCommandSwitchBox();}else{window.localStorage.setItem(sel,'false');buildCommandSwitchBox();}
        });
        $("input#SW06SB").change(function () {
            var sel = 'switchBox' + activeRoom.id + '.SW06SB';
            if($(this).is(":checked")){window.localStorage.setItem(sel,'true');buildCommandSwitchBox();}else{window.localStorage.setItem(sel,'false');buildCommandSwitchBox();}
        });


        $("input#TSW01SB").change(function () {
            var sel = 'switchBox' + activeRoom.id;
            if ($(this).is(":checked")) {
                window.localStorage.setItem(sel+'.TSW01SB', 'true');
                buildCommandSwitchBox();
            } else {
                window.localStorage.setItem(sel+'.TSW01SB', 'false');
                buildCommandSwitchBox();
            }
        });
        $("input#TSW02SB").change(function () {
            var sel = 'switchBox' + activeRoom.id;
            if ($(this).is(":checked")) {
                window.localStorage.setItem(sel+'.TSW02SB', 'true');
                buildCommandSwitchBox();
            } else {
                window.localStorage.setItem(sel+'.TSW02SB', 'false');
                buildCommandSwitchBox();
            }
        });
        $("input#TSW03SB").change(function () {
            var sel = 'switchBox' + activeRoom.id;
            if ($(this).is(":checked")) {
                window.localStorage.setItem(sel+'.TSW03SB', 'true');
                buildCommandSwitchBox();
            } else {
                window.localStorage.setItem(sel+'.TSW03SB', 'false');
                buildCommandSwitchBox();
            }
        });
        $("input#TSW04SB").change(function () {
            var sel = 'switchBox' + activeRoom.id;
            if ($(this).is(":checked")) {
                window.localStorage.setItem(sel+'.TSW04SB', 'true');
                buildCommandSwitchBox();
            } else {
                window.localStorage.setItem(sel+'.TSW04SB', 'false');
                buildCommandSwitchBox();
            }
        });
        $("input#TSW05SB").change(function () {
            var sel = 'switchBox' + activeRoom.id;
            if ($(this).is(":checked")) {
                window.localStorage.setItem(sel+'.TSW05SB', 'true');
                buildCommandSwitchBox();
            } else {
                window.localStorage.setItem(sel+'.TSW05SB', 'false');
                buildCommandSwitchBox();
            }
        });
        $("input#TSW06SB").change(function () {
            var sel = 'switchBox' + activeRoom.id;
            if ($(this).is(":checked")) {
                window.localStorage.setItem(sel+'.TSW06SB', 'true');
                buildCommandSwitchBox();
            } else {
                window.localStorage.setItem(sel+'.TSW06SB', 'false');
                buildCommandSwitchBox();
            }
        });


        $("input#T01ONSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T01ONSB', $("input#T01ONSB").val());
            buildCommandSwitchBox();
        });
        $("input#T01OFFSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T01OFFSB', $("input#T01OFFSB").val());
            buildCommandSwitchBox();
        });
        $("input#T02ONSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T02ONSB', $("input#T02ONSB").val());
            buildCommandSwitchBox();
        });
        $("input#T02OFFSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T02OFFSB', $("input#T02OFFSB").val());
            buildCommandSwitchBox();
        });
        $("input#T03ONSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T03ONSB', $("input#T03ONSB").val());
            buildCommandSwitchBox();
        });
        $("input#T03OFFSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T03OFFSB', $("input#T03OFFSB").val());
            buildCommandSwitchBox();
        });
        $("input#T04ONSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T04ONSB', $("input#T04ONSB").val());
            buildCommandSwitchBox();
        });
        $("input#T04OFFSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T04OFFSB', $("input#T04OFFSB").val());
            buildCommandSwitchBox();
        });
        $("input#T05ONSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T05ONSB', $("input#T05ONSB").val());
            buildCommandSwitchBox();
        });
        $("input#T05OFFSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T05OFFSB', $("input#T05OFFSB").val());
            buildCommandSwitchBox();
        });
        $("input#T06ONSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T06ONSB', $("input#T06ONSB").val());
            buildCommandSwitchBox();
        });
        $("input#T06OFFSB").bind("change", function (event, ui) {
            var sel = 'switchBox' + activeRoom.id;
            window.localStorage.setItem(sel+'.T06OFFSB', $("input#T06OFFSB").val());
            buildCommandSwitchBox();
        });

    });

}



// appCO2Free CO2 level control app v.0.0.2 (c) Vaidotas Gudaitis
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function appCO2Free(){

    $(document).on('pagebeforeshow', '#CO2', function(){

        $('h1#appCO2FreeHeader').html(activeRoom.label);

        var sel = 'co2Free' + activeRoom.id;

        if (window.localStorage.getItem(sel+'.setTemperature')) $("input#temperatureSetCO2").val(window.localStorage.getItem(sel+'.setTemperature')).slider("refresh");
        if (window.localStorage.getItem(sel+'.setCo2Level')) $("input#co2LevelSetCO2").val(window.localStorage.getItem(sel+'.setCo2Level')).slider("refresh");

        if (window.localStorage.getItem(sel+'.fanOn') == 'true')     {
            $("input#fanSwCO2").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#fanSwCO2").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.setMode') == 'heating') {
            $("input#modeSetSwCO2").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#modeSetSwCO2").prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.enableFanTimer') == 'true')   {
            $("input#fanTimerSwCO2").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#fanTimerSwCO2").prop("checked", false).flipswitch("refresh");
        }

        if (window.localStorage.getItem(sel+'.fanFrom')) $('input#fanFromCO2').val(window.localStorage.getItem(sel+'.fanFrom'));
        if (window.localStorage.getItem(sel+'.fanTo')) $('input#fanToCO2').val(window.localStorage.getItem(sel+'.fanTo'));

    });

    $(document).on('pagecreate', '#CO2', function () {

        function buildCommandCo2Free() {

            var CID = window.localStorage.getItem('co2Free.APPID') || 'oa';
            var tSet = $("input#temperatureSetCO2").val() || '23';
            var cSet = $("input#co2LevelSetCO2").val() || '400';
            var fanFrom = $("#fanFromCO2").val() || '00:00';
            var fanTo = $("#fanToCO2").val() || '00:00';
            var roomID = activeRoom.id;

            if (fanFrom.length < 5) fanFrom = '0' + fanFrom;
            if (fanTo.length < 5) fanTo = '0' + fanTo;
            if (tSet.length < 2) tSet = '0' + tSet;

            var command = '';
            command = 'F';
            command += roomID + ':';
            command += 'T=' + tSet + '.00';
            command += 'C=' + cSet;

            if ($("input#fanSwCO2").is(":checked")) {
                command += 'R=1';
            } else {
                if ($('input#fanTimerSwCO2').is(':checked')) {
                    command += 'R=T';
                } else {
                    command += 'R=0';
                }
            }
            command += 'R=' + fanFrom + fanTo;
            if ($('input#modeSetSwCO2').is(':checked')) {
                command += 'M=H';
            } else {
                command += 'M=C';
            }
            var commandToPost = {decision: 'setCommand', roomID: roomID, command: command};

            appCommandPost(tokenLink, commandToPost);
        }

        function appSave(postData) {
            var key = 'co2Free' + activeRoom.id + '.';
            var value = '';

            if (postData.decision === 'setTemperature') {
                key +=  postData.decision;
                value = postData.temperature;
                window.localStorage.setItem(key, value);
                buildCommandCo2Free();
            }

            if (postData.decision === 'setCo2Level') {
                key +=  postData.decision;
                value = postData.co2Level;
                window.localStorage.setItem(key, value);
                buildCommandCo2Free();
            }

            if (postData.decision === 'fanOn') {
                key +=  postData.decision;
                value = postData.SW;
                window.localStorage.setItem(key, value);
                buildCommandCo2Free();
            }

            if (postData.decision === 'setMode') {
                key += postData.decision;
                value = postData.mode;
                window.localStorage.setItem(key, value);
                buildCommandCo2Free();
            }

            if (postData.decision === 'enableFanTimer') {
                key += postData.decision;
                value = postData.SW;
                window.localStorage.setItem(key, value);
                buildCommandCo2Free();
            }

        }


        $("input#temperatureSetCO2").change(function () {
            var tVal = $(this).val();
            $('label#temperatureSetLabelCO2').text('Temperature set to ' + tVal + ' °C');
            var postData = {decision: 'setTemperature', temperature: tVal};
            appSave(postData);
        });

        $("input#co2LevelSetCO2").change(function () {
            var cVal = $(this).val();
            $('label#co2LevelSetLabelCO2').text('CO2 level set to ' + cVal + ' ppm');
            var postData = {decision: 'setCo2Level', co2Level: cVal};
            appSave(postData);
        });

        $("input#fanSwCO2").on("change", function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'fanOn', SW: true};
                appSave(postData);
            } else {
                postData = {decision: 'fanOn', SW: false};
                appSave(postData);
            }
        });

        $("input#modeSetSwCO2").change(function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'setMode', mode: 'heating'};
                appSave(postData);
            } else {
                postData = {decision: 'setMode', mode: 'cooling'};
                appSave(postData);
            }
        });

        $("input#fanTimerSwCO2").change(function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'enableFanTimer', SW: true};
                appSave(postData);
            } else {
                postData = {decision: 'enableFanTimer', SW: false};
                appSave(postData);
            }
        });

        $("input#fanFromCO2").bind("change", function (event, ui) {
            var sel = 'co2Free' + activeRoom.id;
            window.localStorage.setItem(sel+'.fanFrom', $("input#fanFromCO2").val());
            buildCommandCo2Free();
        });

        $("input#fanToCO2").bind("change", function (event, ui) {
            var sel = 'co2Free' + activeRoom.id;
            window.localStorage.setItem(sel+'.fanTo', $("input#fanToCO2").val());
            buildCommandCo2Free();
        });
    });

}



// appComfortZone Temperature control for fancoils v.0.0.1 (c) Vaidotas Gudaitis
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function appComfortZone(){

    $(document).on('pagebeforeshow', '#Comfort-Zone', function(){

        $('h1#appComfortZoneHeader').html(activeRoom.label);

        var sel = 'comfortZone' + activeRoom.id;

        if (window.localStorage.getItem(sel+'.setTemperature')) $("input#temperatureSetCZ").val(window.localStorage.getItem(sel+'.setTemperature')).slider("refresh");
        if (window.localStorage.getItem(sel+'.setFanSpeed')) $("input#fanSpeedSetCZ").val(window.localStorage.getItem(sel+'.setFanSpeed')).slider("refresh");

        if (window.localStorage.getItem(sel+'.powerOn') == 'true')     {
            $("input#powerOnSwCZ").prop("checked", true).flipswitch("refresh");
        } else {
            $("input#powerOnSwCZ").prop("checked", false).flipswitch("refresh");
        }

        if (window.localStorage.getItem(sel+'.setMode') == 'heating') {
            $("input#modeSetCZ").prop("checked", true).flipswitch("refresh");
        }  else{
            $("input#modeSetCZ").prop("checked", false).flipswitch("refresh");
        }

        if (window.localStorage.getItem(sel+'.enableOffHours') == 'true')   {
            $("input#offlineHoursModeSetCZ").prop("checked", true).flipswitch("refresh");
        } else{
            $("input#offlineHoursModeSetCZ").prop("checked", false).flipswitch("refresh");
        }

        if (window.localStorage.getItem(sel+'.offHB')) $('input#offHBCZ').val(window.localStorage.getItem(sel+'.offHB'));
        if (window.localStorage.getItem(sel+'.offHE')) $('input#offHECZ').val(window.localStorage.getItem(sel+'.offHE'));

    });

    $(document).on('pagecreate', '#Comfort-Zone',  function () {

        function buildCommandComfortZone() {
            var CID = window.localStorage.getItem('comfortZone.APPID') || 'oa';
            var tSet = $("#temperatureSetCZ").val() || '23';
            var fSet = $("#fanSpeedSetCZ").val() || '4';
            var offFrom = $("#offHBCZ").val() || '00:00';
            var offTo = $("#offHECZ").val() || '00:00';
            var roomID = activeRoom.id;
            if (offFrom.length < 5) offFrom = '0' + offFrom;
            if (offTo.length < 5) offTo = '0' + offTo;
            if (tSet.length < 2) tSet = '0' + tSet;
            var command = '';
            command = 'F';
            command += roomID + ':';
            command += 'R=' + fSet;
            command += 'T=' + tSet + '.00';
            if ($('input#powerOnSwCZ').is(':checked')) {
                command += 'S=1';
            } else {
                command += 'S=0';
            }
            if ($('input#modeSetCZ').is(':checked')) {
                command += 'M=H';
            } else {
                command += 'M=C';
            }
            if ($('input#offlineHoursModeSetCZ').is(':checked')) {
                command += 'A=0';
            } else {
                command += 'A=1';
            }
            command += 'O=' + offFrom + offTo;
            var commandToPost = {decision: 'setCommand', roomID: roomID, command: command};

            appCommandPost(tokenLink, commandToPost);
        }

        function appSave(postData) {

            var key = 'comfortZone' + activeRoom.id + '.';
            var value = '';

            if (postData.decision === 'setTemperature') {
                key +=  postData.decision;
                value = postData.temperature;
                window.localStorage.setItem(key, value);
                buildCommandComfortZone();
            }

            if (postData.decision === 'setFanSpeed') {
                key +=  postData.decision;
                value = postData.fanSpeed;
                window.localStorage.setItem(key, value);
                buildCommandComfortZone();
            }

            if (postData.decision === 'powerOn') {
                key +=  postData.decision;
                value = postData.SW;

                if (window.localStorage.getItem(key) != value){
                    window.localStorage.setItem(key, value);
                    buildCommandComfortZone();
                }
            }

            if (postData.decision === 'setMode') {
                key += postData.decision;
                value = postData.mode;
                window.localStorage.setItem(key, value);
                buildCommandComfortZone();
            }

            if (postData.decision === 'enableOffHours') {
                key += postData.decision;
                value = postData.SW;
                window.localStorage.setItem(key, value);
                buildCommandComfortZone();
            }

        }


        $("input#temperatureSetCZ").change(function () {
            var tVal = $(this).val();
            $('label#temperatureLabelCZ').text('Temperature set to ' + tVal + ' °C');
            var postData = {decision: 'setTemperature', temperature: tVal};
            appSave(postData);
        });

        $("input#fanSpeedSetCZ").change(function () {
            var fVal = $(this).val();

            if (fVal == 4) {
                $('label#fanSpeedLabelCZ').text('Fan speed - Auto ');
            } else {
                $('label#fanSpeedLabelCZ').text('Fan speed set to ' + fVal);
            }
            var postData = {decision: 'setFanSpeed', fanSpeed: fVal};
            appSave(postData);
        });

        $("input#powerOnSwCZ").on("change", function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'powerOn', SW: true};
            } else {
                postData = {decision: 'powerOn', SW: false};
            }
            appSave(postData);
        });

        $("input#modeSetCZ").change(function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'setMode', mode: 'heating'};
            } else {
                postData = {decision: 'setMode', mode: 'cooling'};
            }
            appSave(postData);
        });

        $("input#offlineHoursModeSetCZ").change(function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'enableOffHours', SW: true};
            } else {
                postData = {decision: 'enableOffHours', SW: false};
            }
            appSave(postData);
        });


        $("input#offHBCZ").bind("change", function (event, ui) {
            window.localStorage.setItem('comfortZone' + activeRoom.id + '.offHB', $("input#offHBCZ").val());
            buildCommandComfortZone();
        });

        $("input#offHECZ").bind("change", function (event, ui) {
            window.localStorage.setItem('comfortZone' + activeRoom.id + '.offHE', $("input#offHECZ").val());
            buildCommandComfortZone();
        });

    });

}



// Green House control app v.0.0.1 (c) Vaidotas Gudaitis
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function appGreenHouse() {

    $('h1#appGreenHouseHeader').html(activeRoom.label);

    $(document).on('pagebeforeshow', '#Green-House', function(){

        var sel = 'greenHouse' + activeRoom.id;

        if (window.localStorage.getItem(sel+'.wateringTimeSet1')) $('#wTbutton1').text("T1 " + window.localStorage.getItem(sel+'.wateringTimeSet1'));
        if (window.localStorage.getItem(sel+'.wateringTimeSet2')) $('#wTbutton2').text("T2 " + window.localStorage.getItem(sel+'.wateringTimeSet2'));
        if (window.localStorage.getItem(sel+'.wateringTimeSet3')) $('#wTbutton3').text("T3 " + window.localStorage.getItem(sel+'.wateringTimeSet3'));
        if (window.localStorage.getItem(sel+'.wateringTimeSet4')) $('#wTbutton4').text("T4 " + window.localStorage.getItem(sel+'.wateringTimeSet4'));
        if (window.localStorage.getItem(sel+'.wateringTimeSet5')) $('#wTbutton5').text("T5 " + window.localStorage.getItem(sel+'.wateringTimeSet5'));
        if (window.localStorage.getItem(sel+'.lightFrom')) $('input#lightOnTime').val(window.localStorage.getItem(sel+'.lightFrom'));
        if (window.localStorage.getItem(sel+'.lightTo')) $('input#lightOffTime').val(window.localStorage.getItem(sel+'.lightTo'));
        if (window.localStorage.getItem(sel+'.setTemperature')) $("input#temperatureSet").val(window.localStorage.getItem(sel+'.setTemperature')).slider("refresh");
        if (window.localStorage.getItem(sel+'.setHumidity')) $("input#humiditySet").val(window.localStorage.getItem(sel+'.setHumidity')).slider("refresh");
        if (window.localStorage.getItem(sel+'.setWateringDuration')) $("input#wateringDurationSet").val(window.localStorage.getItem(sel+'.setWateringDuration')).slider("refresh");

        if (window.localStorage.getItem(sel+'.lightEnable') == 'true')   {
            $('input#lightOnSw').prop("checked", true).flipswitch("refresh");
        }else{
            $('input#lightOnSw').prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.fanEnable') == 'true')     {
            $('input#fanOnSw').prop("checked", true).flipswitch("refresh");
        }else{
            $('input#fanOnSw').prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.enableOnHours') == 'true') {
            $('input#wateringTimerSW').prop("checked", true).flipswitch("refresh");
        }else{
            $('input#wateringTimerSW').prop("checked", false).flipswitch("refresh");
        }
        if (window.localStorage.getItem(sel+'.lightTimer') == 'true')    {
            $('input#lightTimerSW').prop("checked", true).flipswitch("refresh");
        } else{
            $('input#lightTimerSW').prop("checked", false).flipswitch("refresh");
        }
    });

    $(document).on('pagebeforeshow', '#wateringTimerSet1', function(){ $('#wateringTimeSet1').val(window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet1')); });
    $(document).on('pagebeforeshow', '#wateringTimerSet2', function(){ $('#wateringTimeSet2').val(window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet2')); });
    $(document).on('pagebeforeshow', '#wateringTimerSet3', function(){ $('#wateringTimeSet3').val(window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet3')); });
    $(document).on('pagebeforeshow', '#wateringTimerSet4', function(){ $('#wateringTimeSet4').val(window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet4')); });
    $(document).on('pagebeforeshow', '#wateringTimerSet5', function(){ $('#wateringTimeSet5').val(window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet5')); });

    $(document).on('pagehide', '#wateringTimerSet1', function(){
        $('#wTbutton1').text("T1 " + window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet1'));
    });
    $(document).on('pagehide', '#wateringTimerSet2', function(){
        $('#wTbutton2').text("T2 " + window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet2'));
    });
    $(document).on('pagehide', '#wateringTimerSet1', function(){
        $('#wTbutton3').text("T3 " + window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet3'));
    });
    $(document).on('pagehide', '#wateringTimerSet1', function(){
        $('#wTbutton4').text("T4 " + window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet4'));
    });
    $(document).on('pagehide', '#wateringTimerSet1', function(){
        $('#wTbutton5').text("T5 " + window.localStorage.getItem('greenHouse' + activeRoom.id +'.wateringTimeSet5'));
    });



    $(document).on('pagecreate', '#Green-House', function () {

        function buildCommandGreenHouse() {
            var sel = 'greenHouse' + activeRoom.id;
            var CID = window.localStorage.getItem('greenHouse.APPID') || 'oa';
            var tSet = $("input#temperatureSet").val() || '00';
            var hSet = $("input#humiditySet").val() || '00';
            var lFrom = $("input#lightOnTime").val() || '00:00';
            var lTo = $("input#lightOffTime").val() || '00:00';

            var roomID = activeRoom.id;
            var timerCount = '5';

            var t1Val = window.localStorage.getItem(sel+'.wateringTimeSet1') || '00:00';
            var t2Val = window.localStorage.getItem(sel+'.wateringTimeSet2') || '00:00';
            var t3Val = window.localStorage.getItem(sel+'.wateringTimeSet3') || '00:00';
            var t4Val = window.localStorage.getItem(sel+'.wateringTimeSet4') || '00:00';
            var t5Val = window.localStorage.getItem(sel+'.wateringTimeSet5') || '00:00';

            if (lFrom.length < 5) lFrom = '0' + lFrom;
            if (lTo.length < 5) lTo = '0' + lTo;
            if (tSet.length < 2) tSet = '0' + tSet;
            if (hSet.length < 2) hSet = '0' + hSet;

            var command = '';
            command = 'F';
            command += roomID + ':';
            command += 'T=' + tSet + '.00';
            command += 'H=' + hSet;

            if ($("#lightOnSw").is(":checked")) {
                command += 'L=1';
            } else {
                if ($('#lightTimerSW').is(':checked')) {
                    command += 'L=T';
                } else {
                    command += 'L=0';
                }
            }
            if ($('input#wateringTimerSW').is(':checked')) {
                command += 'A=0';
            } else {
                command += 'A=1';
            }
            if ($('input#fanOnSw').is(':checked')) {
                command += 'R=1';
            } else {
                command += 'R=0';
            }
            command += 'L=' + lFrom + lTo;
            var timerSeconds = $('input#wateringDurationSet').val();
            command += 'I=B' + timerCount + '0' + timerSeconds + 't';
            command += t1Val + t2Val + t3Val + t4Val + t5Val;

            var commandToPost = {decision: 'setCommand', roomID: roomID, command: command};

            appCommandPost(tokenLink, commandToPost);

        }

        function appSave(postData) {

            var key = 'greenHouse' + activeRoom.id + '.';
            var value = '';

            if (postData.decision === 'setTemperature') {
                key +=  postData.decision;
                value = postData.temperature;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }

            if (postData.decision === 'setHumidity') {
                key +=  postData.decision;
                value = postData.humidity;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }

            if (postData.decision === 'lightEnable') {
                key +=  postData.decision;
                value = postData.SW;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();

            }

            if (postData.decision === 'fanEnable') {
                key +=  postData.decision;
                value = postData.SW;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }

            if (postData.decision === 'lightTimer') {
                key +=  postData.decision;
                value = postData.SW;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }

            if (postData.decision === 'lightFrom') {
                key +=  postData.decision;
                value = postData.lightFrom;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }

            if (postData.decision === 'lightTo') {
                key +=  postData.decision;
                value = postData.lightTo;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }

            if (postData.decision === 'enableOnHours') {
                key += postData.decision;
                value = postData.SW;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }

            if (postData.decision === 'setWateringDuration') {
                key +=  postData.decision;
                value = postData.duration;
                window.localStorage.setItem(key, value);
                buildCommandGreenHouse();
            }
        }

        $("#temperatureSet").change(function () {
            var tVal = $(this).val();
            $('#tSetLabel').text('Temperature set to ' + tVal  + ' °C');
            var postData = {decision: 'setTemperature', temperature: tVal};
            appSave(postData);
        });

        $("#humiditySet").change(function () {
            var hVal = $(this).val();
            $('#hSetLabel').text('Humidity set to ' + hVal + ' %');
            var postData = {decision: 'setHumidity', humidity: hVal};
            appSave(postData);
        });

        $("#wateringDurationSet").change(function () {
            var wVal = $(this).val();
            $('#wSetLabel').text('Watering duration set to ' + wVal + ' s');
            var postData = {decision: 'setWateringDuration', duration: wVal};
            appSave(postData);
        });

        $("#lightOnSw").on("change", function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'lightEnable', SW: true};
                appSave(postData);
            } else {
                postData = {decision: 'lightEnable', SW: false};
                appSave(postData);
            }
        });

        $("#fanOnSw").change(function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'fanEnable', SW: true};
                appSave(postData);
            } else {
                postData = {decision: 'fanEnable', SW: false};
                appSave(postData);
            }
        });

        $("#wateringTimerSW").change(function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'enableOnHours', SW: true};
                appSave(postData);
            } else {
                postData = {decision: 'enableOnHours', SW: false};
                appSave(postData);
            }
        });

        $("#lightTimerSW").change(function () {
            var postData = {};
            if ($(this).is(":checked")) {
                postData = {decision: 'lightTimer', SW: true};
                appSave(postData);
            } else {
                postData = {decision: 'lightTimer', SW: false};
                appSave(postData);
            }
        });

        $("#wateringTimeSet1").bind("change", function (event, ui) {
            window.localStorage.setItem('greenHouse' + activeRoom.id +'.wateringTimeSet1', $("#wateringTimeSet1").val());
            buildCommandGreenHouse();
        });
        $("#wateringTimeSet2").bind("change", function (event, ui) {
            window.localStorage.setItem('greenHouse' + activeRoom.id +'.wateringTimeSet2', $("#wateringTimeSet2").val());
            buildCommandGreenHouse();
        });
        $("#wateringTimeSet3").bind("change", function (event, ui) {
            window.localStorage.setItem('greenHouse' + activeRoom.id +'.wateringTimeSet3', $("#wateringTimeSet3").val());
            buildCommandGreenHouse();
        });
        $("#wateringTimeSet4").bind("change", function (event, ui) {
            window.localStorage.setItem('greenHouse' + activeRoom.id +'.wateringTimeSet4', $("#wateringTimeSet4").val());
            buildCommandGreenHouse();
        });
        $("#wateringTimeSet5").bind("change", function (event, ui) {
            window.localStorage.setItem('greenHouse' + activeRoom.id +'.wateringTimeSet5', $("#wateringTimeSet5").val());
            buildCommandGreenHouse();
        });
        $("#lightOnTime").bind("change", function (event, ui) {
            window.localStorage.setItem('greenHouse' + activeRoom.id +'.lightFrom', $("#lightOnTime").val());
            buildCommandGreenHouse();
        });
        $("#lightOffTime").bind("change", function (event, ui) {
            window.localStorage.setItem('greenHouse' + activeRoom.id +'.lightTo', $("#lightOffTime").val());
            buildCommandGreenHouse();
        });

    });
}


</script>
</body>
</html>
